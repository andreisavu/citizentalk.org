{% extends "base_layout.html" %}

{% load comments %}

{% block title %}CitizenTalk - {{ issue.title }}{% endblock %}

{% block content %}
{% get_comment_count for issue as comment_count %}

<div id="view-issue-content">
    <h1>{{ issue.title }}</h1>

    <br />
    <p>{{ issue.description }}</p>

    <br /><br />
    Reporter: {{ issue.reporter }}

    <br /><br />
    Add status changing buttons and voting button.
    <br /><br />

<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="citizentalk">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>

    <br /><br />
    Institutions in charge<br />
    {% for inst in institutions %}
        <b><a href="/institutions/{{ inst.id }}">{{ inst }}</a></b>
    {% endfor %}
</div><!-- #view-issue-content -->

        <div id="map-view-issue">
        <div id="map-view-issue-container">
            <!-- -->
        </div><!-- #map-view-issue-container -->

    <script type="text/javascript" src="http://api.maps.yahoo.com/ajaxymap?v=3.8&appid=A89ep3fV34E7xmR7phcrGoALC_7by21vdTDllAAXHkWIT6ON_iQJbI6LOCndWbN0"></script>

    <script type="text/javascript">  
        var map = new YMap(document.getElementById('map-view-issue-container'));
        var currentGeoPoint = new YGeoPoint({{ issue.latitude }}, {{ issue.longitude }});

        map.addTypeControl();
        map.addZoomLong();
        map.addPanControl();
        map.setMapType(YAHOO_MAP_HYB);
        map.drawZoomAndCenter(currentGeoPoint, 12);

        map.addMarker(currentGeoPoint);
    </script>
    </div><!-- map-view-issue -->

    <div class="clear">
        <!-- -->
    </div><!-- .clear -->

    {% render_comment_list for issue %}

    <form method="post" action="/issues/comment/new/" style="width: 100%">
        {% csrf_token %}
        <input type="hidden" name="issue_id" value="{{ issue.id }}" />
        <textarea name="content" style="width: 100%" rows="10"></textarea>
        <input type="submit" value="Post Comment" />
    </form>

{% endblock %}
